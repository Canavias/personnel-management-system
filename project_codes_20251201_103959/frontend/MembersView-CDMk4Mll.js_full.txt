=== ./frontend/dist/assets/MembersView-CDMk4Mll.js ===
import{d as K,r as v,a as oe,m as x,A as H,p as P,w as l,f as s,e,B as G,g as c,b as E,o as T,E as A,C as ne,_ as J,z as re,c as se,i as ue,D as ie,F as de,G as me,t as I,y as pe}from"./index-BcrAjMzN.js";import{u as Q}from"./member-GMhVC9U1.js";const ce={class:"dialog-footer"},_e=K({__name:"MemberDialog",props:{visible:{type:Boolean},editData:{}},emits:["update:visible","success"],setup(j,{emit:M}){const p=j,y=M,g=Q(),b=v(),f=v(!1),a=oe({name:"",gender:"",grade:"",phone:"",email:"",department_id:null,role_id:null}),V=x({get:()=>p.visible,set:u=>y("update:visible",u)}),S=x(()=>p.editData?"编辑成员":"新增成员"),z=x(()=>{const u={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],grade:[{required:!0,message:"请输入年级",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}]};return a.role_id!==1&&(u.department_id=[{required:!0,message:"请选择部门",trigger:"change"}]),u}),R=u=>{u===1&&(a.department_id=null)},N=()=>{a.name="",a.gender="",a.grade="",a.phone="",a.email="",a.department_id=null,a.role_id=null},C=()=>{var u;V.value=!1,N(),(u=b.value)==null||u.clearValidate()},O=async()=>{if(b.value)try{if(!await b.value.validate())return;f.value=!0,p.editData?(await g.updateMember(p.editData.id,a),A.success("更新成功")):(await g.createMember(a),A.success("创建成功")),y("success"),C()}catch(u){console.error("提交失败:",u),A.error("操作失败")}finally{f.value=!1}};return H(()=>p.visible,u=>{u&&p.editData&&ne(()=>{Object.assign(a,{...p.editData,department_id:p.editData.department_id||null,role_id:p.editData.role_id||null})})}),(u,n)=>{const k=s("el-input"),_=s("el-form-item"),B=s("el-radio"),$=s("el-radio-group"),m=s("el-option"),q=s("el-select"),F=s("el-alert"),o=s("el-form"),t=s("el-button"),h=s("el-dialog");return T(),P(h,{modelValue:V.value,"onUpdate:modelValue":n[7]||(n[7]=i=>V.value=i),title:S.value,width:"500px","before-close":C},{footer:l(()=>[E("span",ce,[e(t,{onClick:C},{default:l(()=>[...n[11]||(n[11]=[c("取消",-1)])]),_:1}),e(t,{type:"primary",onClick:O,loading:f.value},{default:l(()=>[...n[12]||(n[12]=[c(" 确认 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[e(o,{ref_key:"formRef",ref:b,model:a,rules:z.value,"label-width":"80px","status-icon":""},{default:l(()=>[e(_,{label:"姓名",prop:"name"},{default:l(()=>[e(k,{modelValue:a.name,"onUpdate:modelValue":n[0]||(n[0]=i=>a.name=i),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(_,{label:"性别",prop:"gender"},{default:l(()=>[e($,{modelValue:a.gender,"onUpdate:modelValue":n[1]||(n[1]=i=>a.gender=i)},{default:l(()=>[e(B,{label:"男"},{default:l(()=>[...n[8]||(n[8]=[c("男",-1)])]),_:1}),e(B,{label:"女"},{default:l(()=>[...n[9]||(n[9]=[c("女",-1)])]),_:1}),e(B,{label:"其他"},{default:l(()=>[...n[10]||(n[10]=[c("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"年级",prop:"grade"},{default:l(()=>[e(k,{modelValue:a.grade,"onUpdate:modelValue":n[2]||(n[2]=i=>a.grade=i),placeholder:"请输入年级"},null,8,["modelValue"])]),_:1}),e(_,{label:"手机",prop:"phone"},{default:l(()=>[e(k,{modelValue:a.phone,"onUpdate:modelValue":n[3]||(n[3]=i=>a.phone=i),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(_,{label:"邮箱",prop:"email"},{default:l(()=>[e(k,{modelValue:a.email,"onUpdate:modelValue":n[4]||(n[4]=i=>a.email=i),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(_,{label:"角色",prop:"role_id"},{default:l(()=>[e(q,{modelValue:a.role_id,"onUpdate:modelValue":n[5]||(n[5]=i=>a.role_id=i),placeholder:"请选择角色",style:{width:"100%"},onChange:R},{default:l(()=>[e(m,{label:"站长",value:1}),e(m,{label:"部长",value:2}),e(m,{label:"副部长",value:3}),e(m,{label:"负责人",value:4}),e(m,{label:"成员",value:5})]),_:1},8,["modelValue"])]),_:1}),a.role_id!==1?(T(),P(_,{key:0,label:"部门",prop:"department_id"},{default:l(()=>[e(q,{modelValue:a.department_id,"onUpdate:modelValue":n[6]||(n[6]=i=>a.department_id=i),placeholder:"请选择部门",style:{width:"100%"}},{default:l(()=>[e(m,{label:"程序部",value:1}),e(m,{label:"游戏部",value:2}),e(m,{label:"Web部",value:3}),e(m,{label:"UI部",value:4}),e(m,{label:"App部",value:5}),e(m,{label:"iOS部",value:7}),e(m,{label:"精英培优班",value:6})]),_:1},8,["modelValue"])]),_:1})):G("",!0),a.role_id===1?(T(),P(_,{key:1},{default:l(()=>[e(F,{title:"站长不属于任何部门",type:"info",closable:!1,"show-icon":""})]),_:1})):G("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),ve=J(_e,[["__scopeId","data-v-ffa1b3fc"]]),be={class:"members"},fe={class:"header"},ge={class:"filter-row"},Ve={class:"pagination"},we=K({__name:"MembersView",setup(j){const M=Q(),p=v(!1),y=v(""),g=v(""),b=v(""),f=v(1),a=v(10),V=v(!1),S=v(null),z=v(!1),R={站长:1,部长:2,副部长:3,负责人:4,成员:5},N=x(()=>M.members.length),C=x(()=>{let o=[...M.members];return y.value&&(o=o.filter(t=>t.name.toLowerCase().includes(y.value.toLowerCase()))),g.value&&(g.value==="0"?o=o.filter(t=>t.department_id===null):o=o.filter(t=>t.department_id==g.value)),b.value&&(o=o.filter(t=>t.role_id==b.value)),o.sort((t,h)=>{const i=(R[t.role_title]||6)-(R[h.role_title]||6);return i!==0?i:t.name.localeCompare(h.name)})}),O=x(()=>{const o=(f.value-1)*a.value,t=o+a.value;return C.value.slice(o,t)}),u=x(()=>{const o={stationMaster:0,minister:0,viceMinister:0,responsiblePerson:0,member:0};return M.members.forEach(t=>{switch(t.role_title){case"站长":o.stationMaster++;break;case"部长":o.minister++;break;case"副部长":o.viceMinister++;break;case"负责人":o.responsiblePerson++;break;case"成员":o.member++;break;default:o.member++}}),o}),n=o=>{switch(o){case"站长":return"danger";case"部长":return"warning";case"副部长":return"success";case"负责人":return"primary";case"成员":return"info";default:return"info"}},k=()=>{f.value=1},_=()=>{f.value=1},B=()=>{S.value=null,z.value=!1,V.value=!0},$=o=>{S.value={...o},z.value=!0,V.value=!0},m=async o=>{try{await pe.confirm("确定要删除这个成员吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await M.deleteMember(o)}catch{}},q=()=>{V.value=!1},F=async()=>{p.value=!0;try{await M.fetchMembers()}catch(o){console.error("加载数据失败:",o),A.error("加载成员数据失败")}finally{p.value=!1}};return H([y,g,b],()=>{f.value=1}),re(()=>{F()}),(o,t)=>{const h=s("el-button"),i=s("el-icon"),X=s("el-input"),d=s("el-option"),L=s("el-select"),W=s("el-card"),D=s("el-statistic"),U=s("el-col"),Y=s("el-row"),w=s("el-table-column"),Z=s("el-tag"),ee=s("el-table"),le=s("el-pagination"),te=me("loading");return T(),se("div",be,[E("div",fe,[t[7]||(t[7]=E("h1",null,"成员管理",-1)),e(h,{type:"primary",onClick:B},{default:l(()=>[...t[6]||(t[6]=[c(" 添加成员 ",-1)])]),_:1})]),e(W,{class:"filter-card"},{default:l(()=>[E("div",ge,[e(X,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=r=>y.value=r),placeholder:"按姓名搜索",style:{width:"200px","margin-right":"10px"},onInput:k},{prefix:l(()=>[e(i,null,{default:l(()=>[e(ue(ie))]),_:1})]),_:1},8,["modelValue"]),e(L,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=r=>g.value=r),placeholder:"选择部门",style:{width:"150px","margin-right":"10px"},onChange:_},{default:l(()=>[e(d,{label:"所有部门",value:""}),e(d,{label:"无部门",value:"0"}),e(d,{label:"程序部",value:"1"}),e(d,{label:"游戏部",value:"2"}),e(d,{label:"Web部",value:"3"}),e(d,{label:"UI部",value:"4"}),e(d,{label:"App部",value:"5"}),e(d,{label:"iOS部",value:"6"}),e(d,{label:"精英培优班",value:"7"})]),_:1},8,["modelValue"]),e(L,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=r=>b.value=r),placeholder:"选择职位",style:{width:"150px"},onChange:_},{default:l(()=>[e(d,{label:"所有职位",value:""}),e(d,{label:"站长",value:"1"}),e(d,{label:"部长",value:"2"}),e(d,{label:"副部长",value:"3"}),e(d,{label:"负责人",value:"4"}),e(d,{label:"成员",value:"5"})]),_:1},8,["modelValue"])])]),_:1}),e(Y,{gutter:20,class:"stats-row"},{default:l(()=>[e(U,{span:4},{default:l(()=>[e(D,{title:"总成员数",value:N.value},null,8,["value"])]),_:1}),e(U,{span:4},{default:l(()=>[e(D,{title:"站长",value:u.value.stationMaster},null,8,["value"])]),_:1}),e(U,{span:4},{default:l(()=>[e(D,{title:"部长",value:u.value.minister},null,8,["value"])]),_:1}),e(U,{span:4},{default:l(()=>[e(D,{title:"副部长",value:u.value.viceMinister},null,8,["value"])]),_:1}),e(U,{span:4},{default:l(()=>[e(D,{title:"负责人",value:u.value.responsiblePerson},null,8,["value"])]),_:1}),e(U,{span:4},{default:l(()=>[e(D,{title:"普通成员",value:u.value.member},null,8,["value"])]),_:1})]),_:1}),e(W,{class:"table-card"},{default:l(()=>[de((T(),P(ee,{data:O.value,style:{width:"100%"}},{default:l(()=>[e(w,{type:"index",width:"60",label:"序号"}),e(w,{prop:"name",label:"姓名",width:"120",sortable:""}),e(w,{prop:"gender",label:"性别",width:"80"}),e(w,{prop:"grade",label:"年级",width:"100",sortable:""}),e(w,{prop:"department_name",label:"部门",width:"130"},{default:l(({row:r})=>[c(I(r.department_name||"无部门"),1)]),_:1}),e(w,{prop:"role_title",label:"职位",width:"130",sortable:""},{default:l(({row:r})=>[e(Z,{type:n(r.role_title),effect:"dark"},{default:l(()=>[c(I(r.role_title),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"phone",label:"电话",width:"130"},{default:l(({row:r})=>[c(I(r.phone||"未填写"),1)]),_:1}),e(w,{prop:"email",label:"邮箱",width:"200"},{default:l(({row:r})=>[c(I(r.email||"未填写"),1)]),_:1}),e(w,{label:"操作",width:"150",fixed:"right"},{default:l(({row:r})=>[e(h,{size:"small",onClick:ae=>$(r)},{default:l(()=>[...t[8]||(t[8]=[c(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(h,{size:"small",type:"danger",onClick:ae=>m(r.id)},{default:l(()=>[...t[9]||(t[9]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,p.value]]),E("div",Ve,[e(le,{"current-page":f.value,"onUpdate:currentPage":t[3]||(t[3]=r=>f.value=r),"page-size":a.value,"onUpdate:pageSize":t[4]||(t[4]=r=>a.value=r),"page-sizes":[10,20,50,100],total:C.value.length,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper","prev-text":"上一页","next-text":"下一页"},null,8,["current-page","page-size","total"])])]),_:1}),e(ve,{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=r=>V.value=r),member:S.value,"is-edit":z.value,onSuccess:q},null,8,["modelValue","member","is-edit"])])}}}),Me=J(we,[["__scopeId","data-v-ccf325e1"]]);export{Me as default};



