=== ./frontend/src/services/api.ts ===
import axios from 'axios'
import { ElMessage } from 'element-plus'
import router from '@/router'

// å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„baseURL
// å‰ç«¯è¿è¡Œåœ¨5173ç«¯å£ï¼Œä½†éœ€è¦ä»£ç†åˆ°3000ç«¯å£
// Viteä»£ç†é…ç½®åº”è¯¥è½¬å‘ /api åˆ° http://localhost:3000/api
const axiosInstance = axios.create({
  baseURL: '/api',  // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè®©Viteä»£ç†å¤„ç†
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ è¯¦ç»†æ—¥å¿—
axiosInstance.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    
    console.log('ğŸš€ å‰ç«¯è¯·æ±‚è¯¦æƒ…:')
    console.log('  æ–¹æ³•:', config.method?.toUpperCase())
    console.log('  å®Œæ•´URL:', config.baseURL + (config.url || ''))
    console.log('  è¯·æ±‚æ•°æ®:', config.data ? JSON.stringify(config.data, null, 2) : 'æ— ')
    
    return config
  },
  (error) => {
    console.error('âŒ è¯·æ±‚é…ç½®é”™è¯¯:', error)
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
axiosInstance.interceptors.response.use(
  (response) => {
    console.log('âœ… å‰ç«¯æ”¶åˆ°å“åº”:')
    console.log('  çŠ¶æ€ç :', response.status)
    console.log('  å“åº”æ•°æ®:', JSON.stringify(response.data, null, 2))
    return response
  },
  (error) => {
    console.error('âŒ å‰ç«¯è¯·æ±‚å¤±è´¥è¯¦æƒ…:')
    console.error('  é”™è¯¯ä¿¡æ¯:', error.message)
    console.error('  çŠ¶æ€ç :', error.response?.status)
    console.error('  é”™è¯¯æ•°æ®:', error.response?.data)
    console.error('  è¯·æ±‚URL:', error.config?.url)
    console.error('  è¯·æ±‚æ–¹æ³•:', error.config?.method)
    console.error('  è¯·æ±‚æ•°æ®:', error.config?.data)
    
    if (error.response?.status === 404) {
      console.error('ğŸš¨ 404é”™è¯¯ï¼å¯èƒ½åŸå› :')
      console.error('  1. åç«¯APIè·¯å¾„ä¸å­˜åœ¨')
      console.error('  2. ä»£ç†é…ç½®é”™è¯¯')
      console.error('  3. åç«¯è·¯ç”±æœªæ³¨å†Œ')
      console.error('  å»ºè®®æ£€æŸ¥:')
      console.error('    - åç«¯routes/members.jsæ˜¯å¦æœ‰PUTè·¯ç”±')
      console.error('    - Viteä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®')
      console.error('    - åç«¯æœåŠ¡å™¨æ˜¯å¦è¿è¡Œåœ¨3000ç«¯å£')
    }
    
    if (error.response?.status === 401) {
      localStorage.removeItem('token')
      ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
      router.push('/login')
    } else if (error.code === 'ERR_NETWORK') {
      ElMessage.error('æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨')
    } else if (error.response?.data?.message) {
      ElMessage.error(error.response.data.message)
    } else {
      ElMessage.error('è¯·æ±‚å¤±è´¥: ' + error.message)
    }
    
    return Promise.reject(error)
  }
)

export const api = axiosInstance



