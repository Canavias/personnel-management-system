=== ./frontend/src/stores/member.ts ===
import { defineStore } from 'pinia'
import { api } from '@/services/api'

export const useMemberStore = defineStore('member', {
  state: () => ({
    members: [] as any[],
    departments: [] as any[],
    roles: [] as any[],
    loading: false
  }),

  getters: {
    // å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ  getters
  },

  actions: {
    // è·å–æ‰€æœ‰æˆå‘˜
    async fetchMembers() {
      try {
        this.loading = true
        const response = await api.get('/members')
        console.log('ğŸ“‹ æˆå‘˜APIå“åº”:', response)
        this.members = response.data.data || response.data
      } catch (error) {
        console.error('è·å–æˆå‘˜åˆ—è¡¨å¤±è´¥:', error)
        throw error
      } finally {
        this.loading = false
      }
    },

    // è·å–éƒ¨é—¨åˆ—è¡¨
    async fetchDepartments() {
      try {
        console.log('ğŸŒ è¯·æ±‚éƒ¨é—¨API...')
        const response = await api.get('/departments')
        console.log('ğŸ¢ éƒ¨é—¨APIå®Œæ•´å“åº”:', response)
        
        // ç»Ÿä¸€å¤„ç†å“åº”æ ¼å¼
        if (response.data && response.data.success) {
          this.departments = response.data.data
          console.log('âœ… éƒ¨é—¨æ•°æ®åŠ è½½æˆåŠŸ:', this.departments.length, 'ä¸ªéƒ¨é—¨')
        } else {
          console.error('éƒ¨é—¨APIè¿”å›é”™è¯¯:', response.data)
          this.departments = []
        }
      } catch (error) {
        console.error('âŒ è·å–éƒ¨é—¨åˆ—è¡¨å¤±è´¥:', error)
        this.departments = []
        throw error
      }
    },

    // è·å–èŒä½åˆ—è¡¨  
    async fetchRoles() {
      try {
        console.log('ğŸŒ è¯·æ±‚èŒä½API...')
        const response = await api.get('/roles')
        console.log('ğŸ’¼ èŒä½APIå®Œæ•´å“åº”:', response)
        
        // ç»Ÿä¸€å¤„ç†å“åº”æ ¼å¼
        if (response.data && response.data.success) {
          this.roles = response.data.data
          console.log('âœ… èŒä½æ•°æ®åŠ è½½æˆåŠŸ:', this.roles.length, 'ä¸ªèŒä½')
        } else {
          console.error('èŒä½APIè¿”å›é”™è¯¯:', response.data)
          this.roles = []
        }
      } catch (error) {
        console.error('âŒ è·å–èŒä½åˆ—è¡¨å¤±è´¥:', error)
        this.roles = []
        throw error
      }
    },

    // æ·»åŠ æˆå‘˜
    async addMember(memberData: any) {
      try {
        const response = await api.post('/members', memberData)
        this.members.push(response.data)
        return response.data
      } catch (error) {
        console.error('æ·»åŠ æˆå‘˜å¤±è´¥:', error)
        throw error
      }
    },

    // æ›´æ–°æˆå‘˜
    async updateMember(id: number, memberData: any) {
      try {
        const response = await api.put(`/members/${id}`, memberData)
        const index = this.members.findIndex((m: any) => m.id === id)
        if (index !== -1) {
          this.members[index] = response.data
        }
        return response.data
      } catch (error) {
        console.error('æ›´æ–°æˆå‘˜å¤±è´¥:', error)
        throw error
      }
    },

    // åˆ é™¤æˆå‘˜
    async deleteMember(id: number) {
      try {
        await api.delete(`/members/${id}`)
        this.members = this.members.filter((m: any) => m.id !== id)
      } catch (error) {
        console.error('åˆ é™¤æˆå‘˜å¤±è´¥:', error)
        throw error
      }
    }
  }
})



