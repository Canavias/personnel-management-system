=== ./backend/config/database_fixed.js ===
const mysql = require('mysql2');

const dbConfig = {
  user: process.env.DB_USER || 'canavias_admin',
  password: process.env.DB_PASSWORD || 'rw7719lxy',
  database: process.env.DB_NAME || 'personnel_management_system',
  socketPath: process.env.DB_SOCKET || '/run/mysqld/mysqld.sock',
  charset: 'utf8mb4',
  timezone: '+08:00',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
};

const pool = mysql.createPool(dbConfig);

// åœ¨èŽ·å–è¿žæŽ¥æ—¶è®¾ç½®å­—ç¬¦é›†
pool.on('connection', (connection) => {
  connection.query("SET NAMES 'utf8mb4'");
  connection.query("SET CHARACTER SET 'utf8mb4'");
  connection.query("SET character_set_connection = 'utf8mb4'");
  connection.query("SET character_set_client = 'utf8mb4'");
  connection.query("SET character_set_results = 'utf8mb4'");
});

// æµ‹è¯•è¿žæŽ¥
pool.getConnection((err, connection) => {
  if (err) {
    console.error('âŒ æ•°æ®åº“è¿žæŽ¥å¤±è´¥:', err.message);
    console.error('ðŸ”§ è¿žæŽ¥é…ç½®:', {
      user: dbConfig.user,
      database: dbConfig.database,
      socketPath: dbConfig.socketPath
    });
    return;
  }
  console.log('âœ… æ•°æ®åº“è¿žæŽ¥æˆåŠŸ - ä½¿ç”¨UTF8å­—ç¬¦é›†');
  connection.query("SHOW VARIABLES LIKE 'character_set%'", (err, results) => {
    if (err) {
      console.error('å­—ç¬¦é›†æŸ¥è¯¢å¤±è´¥:', err);
    } else {
      console.log('ðŸ”§ å½“å‰å­—ç¬¦é›†é…ç½®:');
      results.forEach(row => {
        if (row.Variable_name.includes('character_set')) {
          console.log(`  ${row.Variable_name}: ${row.Value}`);
        }
      });
    }
    connection.release();
  });
});

module.exports = {
  pool: pool.promise()
};



